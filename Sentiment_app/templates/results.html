
{% extends "base.html" %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <h1 class="h4 mb-3">Analysis Results</h1>
        <div class="mb-3">
          <span class="badge 
            {% if result.sentiment == 'Positive' %}bg-success
            {% elif result.sentiment == 'Negative' %}bg-danger
            {% else %}bg-secondary{% endif %}
          " style="font-size: 1rem;">{{ result.sentiment }}</span>
        </div>
        <div class="mb-3">
          <label class="form-label mb-1">Polarity (âˆ’1 to +1)</label>
          <div class="progress" role="progressbar" aria-label="Polarity">
            {% set pol_percent = ((result.polarity + 1) / 2.0) * 100 %}
            <div class="progress-bar 
              {% if result.polarity > 0.05 %}bg-success
              {% elif result.polarity < -0.05 %}bg-danger
              {% else %}bg-secondary{% endif %}
            " style="width: {{ '%.1f'|format(pol_percent) }}%">
              {{ '%.3f'|format(result.polarity) }}
            </div>
          </div>
        </div>
        <div class="mb-4">
          <label class="form-label mb-1">Subjectivity (0 to 1)</label>
          <div class="progress" role="progressbar" aria-label="Subjectivity">
            <div class="progress-bar" style="width: {{ '%.1f'|format(result.subjectivity * 100) }}%">
              {{ '%.3f'|format(result.subjectivity) }}
            </div>
          </div>
          <div class="form-text">0 = objective, 1 = highly opinionated.</div>
        </div>
        <div class="mb-3">
          <h2 class="h6">Normalized Text</h2>
          <div class="p-3 bg-body-tertiary rounded border small">{{ result.text }}</div>
        </div>
        <a href="{{ url_for('index') }}" class="btn btn-primary">Analyze Another</a>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <h2 class="h6 mb-3">At a Glance</h2>
        <canvas id="gaugePolarity" height="180"></canvas>
        <canvas id="gaugeSubjectivity" height="180" class="mt-3"></canvas>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const pol = {{ '%.3f'|format(result.polarity) }};
        const subj = {{ '%.3f'|format(result.subjectivity) }};

        function doughnut(id, value, min, max) {
          const ctx = document.getElementById(id).getContext('2d');
          const normalized = (value - min) / (max - min);
          return new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: ['Value', 'Remainder'],
              datasets: [{
                data: [normalized, 1 - normalized]
              }]
            },
            options: {
              cutout: '70%',
              plugins: {
                legend: { display: false },
                tooltip: { enabled: false }
              }
            }
          });
        }
        doughnut('gaugePolarity', pol, -1, 1);
        doughnut('gaugeSubjectivity', subj, 0, 1);
      });
    </script>
  </div>
</div>
{% endblock %}
